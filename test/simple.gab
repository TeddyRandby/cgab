'fiber':require  

server = :fiber do
  def sk = 'socket':require

  status, socket = :socket in
    match
      .ok => socket:print end
      else => status:print end

  def port = 8080

  status = socket:bind(port) in
    match
      .ok => 'Bound to ::{port}':print end
      else => status:print end

  status = socket:listen(10) in
    match
      .ok => 'Listening!':print end
      else => status:print end

  yield .ok

  'Accepting connections...':print

  status, conn = socket:accept
end

server:await:print

client = :fiber do
  def sk = 'socket':require

  status, socket = :socket in
    match
      .ok => socket:print end
      else => status:print end

  status = socket:connect('127.0.0.1', 8080) in
    match
      .ok => 'Connected!':print end
      else => status:print end
end

server(.ok)

client:await

server:await
