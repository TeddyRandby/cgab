:use .fibers
:use .channel
:use .lists
:use .numbers
:use .streams

def work = :channel.new

1000 :times do (i)
  work << 'HI from {i}'
end

def workers = :list.new

1 :times do (i)
  workers:push!(:fiber.new do
    :use .channel

    loop
      status, job = work:await

      status == .none and return

      job:print
    end
  end)
end

workers:for(&:values, &:await)
