\doquicksort_fold :defcase! {
  .true (lists x) => do
    lhs = lists :at! 0 :push x

    [lhs, lists:at! 1]
  end

  .false (lists x) => do
    rhs = lists:at! 1 :push x
    [lists:at! 0, rhs]
  end
}

\doquicksort_empty :defcase! {
  .true () => []
  .false (seq) => do
    pivot = seq :at! 0
    halves = seq:reduce(
      [ [] [] ],
      (lists x) => do
        x :< pivot :doquicksort_fold(lists x)
      end)

    halves:println

    halves:at! 0 :sort:push(halves:at! 1 :sort :**)
  end
}

\empty?:def!(
  'record'
  () => self:len == 0
)

\sort:def!(
  'record'
  () => do
    self :empty? :doquicksort_empty self
end)

[1 2 3] :sort :println
[3 2 1] :sort :println
