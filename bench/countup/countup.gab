:use .rec

def upto[.Number]
  i = 0

  loop
    yield i
    i = i + 1
  until i == self end

end

def fold[](msg, init, cb)
  acc = init
  *args, suspense = self:(msg)

  loop
    ?suspense == .Suspense or break acc

    acc = cb(acc, args:splat)            

    *args, suspense = suspense()
  end
end

sum = 1000000:fold(&:upto, 0) do (acc, curr)
  acc + curr
end
