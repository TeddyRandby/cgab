:use .list
:use .streams

def [][.List](key)
  self:at(key)
end

def each[.List]
  self:len == 0 and return

  v = 0 
  loop
    yield self:at(v), v
    v = v + 1
  until v >= self:len end
end

def <<[.List](other)
  other:for(&:each) do; self:push!(@1) end
  
  self
end

def list.collect[](msg, *p)
  def l = :list.new

  *args, suspense = self:(msg)(p:splat)

  loop
    ?suspense == .Suspense or break

    l:push!(args:splat)    

    *args, suspense = suspense()
  end

  return l
end
