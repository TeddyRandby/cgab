require('std')

def TestState  { fails }

def testState[nil]
    :record(TestState):reset
end

impl TestState 
    def reset
        self.fails = 0

        self
    end

    def fail
        self.fails = self.fails + 1
    end

    def passed?
        self.fails == 0
    end
end

def T = :testState

def expect[](other, opt_msg)
    def msg = opt_msg or &==
    self:send(msg, other) or T:fail
end

def expect_not[](other, opt_msg)
    def msg = opt_msg or &==
    self:send(msg, other) and T:fail
end

impl nil
    def describe(name, cb)
        print('\n{name}:')
        cb()
    end

    def it(name, cb)
        T:reset

        cb()

        print('  {T:passed? and 'âœ“' or 'Ã—'} it {name}')
    end
end
